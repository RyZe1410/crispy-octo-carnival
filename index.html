<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>PlutoTV Style – M3U8 Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* ---------- RESET ---------- */
*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  background: #0d0d0d;
  color: #ffffff;
  font-family: "Segoe UI", Arial, sans-serif;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* ---------- HEADER ---------- */
.header {
  background: #141414;
  padding: 1rem 1.5rem;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 2px 6px rgba(0,0,0,.4);
  position: sticky;
  top: 0;
  z-index: 10;
  flex-wrap: wrap;
  gap: 1rem;
}

.header__section {
  display: flex;
  align-items: center;
  gap: 2rem;
}

.header__logo {
  font-size: 1.75rem;
  font-weight: 700;
  letter-spacing: 1px;
  color: #e50914;
}

.header__nav {
  display: flex;
  gap: 0.5rem;
}

.nav__btn {
  background: transparent;
  border: none;
  color: #808080;
  padding: 0.5rem 1rem;
  font-size: 1rem;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.3s ease;
}

.nav__btn:hover {
  color: #ffffff;
  background: rgba(255,255,255,0.1);
}

.nav__btn--active {
  color: #ffffff;
  background: #e50914;
}

/* ---------- SEARCH ---------- */
.header__search {
  position: relative;
  display: flex;
  align-items: center;
}

.search__input {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  color: #ffffff;
  padding: 0.5rem 2.5rem 0.5rem 1rem;
  border-radius: 25px;
  font-size: 0.9rem;
  width: 200px;
  transition: all 0.3s ease;
}

.search__input:focus {
  outline: none;
  border-color: #e50914;
  background: rgba(255,255,255,0.15);
  width: 250px;
}

.search__icon {
  position: absolute;
  right: 10px;
  color: #808080;
  pointer-events: none;
}

/* ---------- MAIN ---------- */
.main {
  flex: 1;
  padding: 1.5rem;
}

/* ---------- CHANNELS GRID ---------- */
.channels {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 1.25rem;
}

/* ---------- CARD ---------- */
.card {
  background: #1c1c1c;
  border-radius: 12px;
  overflow: hidden;
  position: relative;
  transition: transform .25s ease, box-shadow .25s ease;
  cursor: pointer;
  aspect-ratio: 16/9;
}

.card:hover {
  transform: translateY(-4px) scale(1.03);
  box-shadow: 0 8px 20px rgba(0,0,0,.5);
}

.card__wrapper {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.card__thumb {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  border-radius: 0;
  aspect-ratio: 16/9;
  width: 100%;
  height: 100%;
  margin: auto;
  border: 2px solid rgba(255,255,255,0.15);
}

.card__play-btn {
  position: absolute;
  width: 60px;
  height: 60px;
  background: rgba(229,9,20,.9);
  border-radius: 50%;
  display: none;
  align-items: center;
  justify-content: center;
  transition: background .3s ease;
}

.card__play-btn:hover {
  background: #e50914;
}

.card__play-icon {
  color: #ffffff;
  font-size: 1.5rem;
  margin-left: 4px;
}

.card__title {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: .5rem;
  font-size: .85rem;
  text-align: center;
  color: #ffffff;
  background: rgba(0,0,0,0.6);
  opacity: 0;
  transition: opacity .3s ease;
}

.card:hover .card__title {
  opacity: 1;
}

/* ---------- HERO SLIDER (TWITCH-STYLE) ---------- */
.hero-slider {
  width: 100%;
  height: 45vh;
  min-height: 280px;
  overflow: hidden;
  position: relative;
  background: #0d0d0d;
}

.hero-slider__track {
  display: flex;
  height: 100%;
  transition: transform .6s ease;
}

.hero-slide {
  flex: 0 0 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  display: flex;
  align-items: flex-end;
  justify-content: flex-start;
  padding: 2rem;
  position: relative;
}

.hero-slide::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.3) 50%, transparent 100%);
}

/* botón EN VIVO fijo abajo-izquierda */
.hero-live-btn {
  position: absolute;
  bottom: 1.5rem;
  left: 1.5rem;
  background: #e50914;
  color: #ffffff;
  padding: .6rem 1.2rem;
  border-radius: 4px;
  font-weight: 700;
  text-decoration: none;
  z-index: 5;
  transition: background .3s ease;
}

.hero-live-btn:hover {
  background: #ff1a25;
}

/* título del canal en slider */
.hero-title {
  position: absolute;
  bottom: 5rem; /* más espacio respecto al botón EN VIVO */
  left: 1.5rem;
  z-index: 5;
  font-size: 1.5rem;
  font-weight: 700;
  text-shadow: 0 2px 4px rgba(0,0,0,0.8);
  pointer-events: none;
  margin-bottom: 0.5rem; /* espacio extra entre texto y botón */
}

/* dots */
.hero-dots {
  position: absolute;
  bottom: 1rem;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: .5rem;
  z-index: 3;
}

.hero-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: rgba(255,255,255,.4);
  cursor: pointer;
  transition: background .3s ease;
}

.hero-dot--active {
  background: #e50914;
}

/* ocultar flecha next en móvil */
.hero-next {
  display: none;
}

.hero-next:hover {
  transform: scale(1.1);
  background: #ff1a25;
}

.hero-next::after {
  content: "▶";
}

/* ---------- RESPONSIVE ---------- */
@media (max-width: 768px) {
  .header {
    flex-direction: column;
    align-items: stretch;
  }
  
  .header__section {
    justify-content: space-between;
  }
  
  .search__input {
    width: 100%;
  }
  
  .search__input:focus {
    width: 100%;
  }
  
  .channels {
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  }
  
  .hero-slider {
    height: 35vh;
    min-height: 200px;
  }
}

@media (min-width: 1200px) {
  .header__logo {
    font-size: 2.5rem;
  }
  
  .nav__btn {
    font-size: 1.2rem;
    padding: 0.75rem 1.5rem;
  }
  
  .channels {
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1.75rem;
  }
  
  .card__title {
    font-size: 1.1rem;
  }
  
  .hero-slider {
    height: 55vh;
    min-height: 400px;
  }
}

@media (min-width: 1920px) {
  .channels {
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  }
}
    </style>
</head>
<body>
  <!-- header simplificado -->
  <header class="header">
    <input type="text" id="searchInput" class="search__input" placeholder="Buscar canales...">
  </header>

  <!-- slider -->
  <section class="hero-slider" id="heroSlider">
    <div class="hero-slider__track" id="heroTrack"></div>
    <!-- dots -->
    <div class="hero-dots" id="heroDots"></div>
    <!-- botón En Vivo fijo -->
    <a class="hero-live-btn" id="heroLiveBtn" href="#" target="_blank">EN VIVO</a>
    <!-- título del canal -->
    <h2 class="hero-title" id="heroTitle"></h2>
  </section>

  <!-- grid -->
  <main class="main">
    <section class="channels" id="channels"></section>
  </main>

  <!-- botón slider -->
  <button class="hero-next" id="heroNext" aria-label="Siguiente"></button>

  <script type="module">
    const M3U_URLS = [
    "https://raw.githubusercontent.com/HelmerLuzo/SamsungTVPlus_HL/refs/heads/main/tv/m3u/SamsungTVPlus_tv_ES.m3u",
    "https://raw.githubusercontent.com/R3D-GHOST/json/refs/heads/main/toro.m3u8"
];

const channelsContainer = document.getElementById("channels");
const searchInput = document.getElementById("searchInput");
const navButtons = document.querySelectorAll('.nav__btn');
const heroTrack = document.getElementById('heroTrack');

let allChannels = [];
let filteredChannels = [];
let heroIndex = 0;
let heroInterval;

async function fetchM3U(url) {
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error("Error al cargar " + url);
    return await res.text();
  } catch (err) {
    console.error("Fallo al cargar M3U:", err);
    return "";
  }
}

function parseM3U(data) {
  const lines = data.split("\n");
  const channels = [];
  let current = {};
  for (const rawLine of lines) {
    const line = rawLine.trim();
    if (line.startsWith("#EXTINF:")) {
      const nameMatch = line.match(/,(.*)$/);
      if (nameMatch) current.name = nameMatch[1].trim();
      const logoMatch = line.match(/tvg-logo="([^"]+)"/);
      if (logoMatch) current.logo = logoMatch[1];
      const grupoMatch = line.match(/group-title="([^"]+)"/);
      if (grupoMatch) current.grupo = grupoMatch[1];
    } else if (line && !line.startsWith("#")) {
      current.url = line;
      if (current.name) channels.push(current);
      current = {};
    }
  }
  return channels;
}

function renderChannel(ch) {
  const card = document.createElement("article");
  card.className = "card";
  card.innerHTML = `
    <div class="card__wrapper">
      <img class="card__thumb" src="${ch.logo || ''}" alt="${ch.name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
      <div class="card__play-btn">
        <span class="card__play-icon">▶</span>
      </div>
      <h3 class="card__title">${ch.name}</h3>
    </div>
  `;
  card.addEventListener("click", () => {
    window.open(ch.url, "_blank");
  });
  channelsContainer.appendChild(card);
}

function renderChannels(channels) {
  channelsContainer.innerHTML = "";
  channels.forEach(renderChannel);
}

function filterChannels(query) {
  const searchTerm = query.toLowerCase();
  filteredChannels = allChannels.filter(ch => 
    ch.name.toLowerCase().includes(searchTerm)
  );
  renderChannels(filteredChannels);
}

function setupNavigation() {
  navButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      navButtons.forEach(b => b.classList.remove('nav__btn--active'));
      btn.classList.add('nav__btn--active');
      
      const filter = btn.dataset.filter;
      if (filter === 'all') {
        renderChannels(allChannels);
      } else {
        renderChannels(filteredChannels);
      }
    });
  });
}

function buildHeroSlider(channels) {
  heroTrack.innerHTML = "";
  const selected = channels.filter(ch => ch.grupo === "En Directo").slice(0, 6);
  selected.forEach((ch, idx) => {
    const slide = document.createElement('div');
    slide.className = 'hero-slide';
    // Asegurar imagen de fondo con fallback inmediato
    const bg = ch.logo && ch.logo.trim() ? `url(${ch.logo})` : 'url(https://via.placeholder.com/1920x1080/222/fff?text=TV)';
    slide.style.backgroundImage = bg;
    slide.dataset.url = ch.url;
    slide.dataset.name = ch.name;
    heroTrack.appendChild(slide);
  });

  // dots
  const dots = document.getElementById('heroDots');
  dots.innerHTML = "";
  selected.forEach((_, idx) => {
    const dot = document.createElement('span');
    dot.className = 'hero-dot' + (idx === 0 ? ' hero-dot--active' : '');
    dot.addEventListener('click', () => goToSlide(idx));
    dots.appendChild(dot);
  });

  // actualizar botón EN VIVO y título con el primer canal
  if (selected.length) {
    const liveBtn = document.getElementById('heroLiveBtn');
    liveBtn.href = selected[0].url;
    document.getElementById('heroTitle').textContent = selected[0].name;
  }

  startAutoSlide(selected.length);
}

function goToSlide(idx) {
  heroIndex = idx;
  heroTrack.style.transform = `translateX(-${idx * 100}%)`;
  document.querySelectorAll('.hero-dot').forEach((d, i) => {
    d.classList.toggle('hero-dot--active', i === idx);
  });
  // actualizar título y botón
  const slides = document.querySelectorAll('.hero-slide');
  if (slides[idx]) {
    document.getElementById('heroTitle').textContent = slides[idx].dataset.name;
    document.getElementById('heroLiveBtn').href = slides[idx].dataset.url;
  }
}

function startAutoSlide(len) {
  if (heroInterval) clearInterval(heroInterval);
  heroInterval = setInterval(() => {
    heroIndex = (heroIndex + 1) % len;
    goToSlide(heroIndex);
  }, 30000); // 30s
}

async function loadChannels() {
  for (const url of M3U_URLS) {
    const data = await fetchM3U(url);
    if (!data) continue;
    const channels = parseM3U(data);
    allChannels.push(...channels);
  }
  buildHeroSlider(allChannels);
  // No mostrar canales del grupo "En Directo" en el grid
  const filteredForGrid = allChannels.filter(ch => ch.grupo !== "En Directo");
  renderChannels(filteredForGrid);
  setupNavigation();
}

searchInput.addEventListener("input", (e) => {
  filterChannels(e.target.value);
});

document.getElementById('heroNext').addEventListener('click', () => {
  const total = document.querySelectorAll('.hero-slide').length;
  if (total === 0) return;
  heroIndex = (heroIndex + 1) % total;
  goToSlide(heroIndex);
});

// Touch swipe para móvil
let touchStartX = 0;
let touchEndX = 0;

const heroSlider = document.getElementById('heroSlider');

heroSlider.addEventListener('touchstart', e => {
  touchStartX = e.changedTouches[0].screenX;
});

heroSlider.addEventListener('touchend', e => {
  touchEndX = e.changedTouches[0].screenX;
  handleSwipe();
});

function handleSwipe() {
  const total = document.querySelectorAll('.hero-slide').length;
  if (total === 0) return;
  if (touchEndX < touchStartX - 30) {
    // swipe izquierda
    heroIndex = (heroIndex + 1) % total;
    goToSlide(heroIndex);
  }
  if (touchEndX > touchStartX + 30) {
    // swipe derecha
    heroIndex = (heroIndex - 1 + total) % total;
    goToSlide(heroIndex);
  }
}

loadChannels();
  </script>
</body>
</html>
